<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Routing Map with Distance</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
    <style>
        #map {
            height: 500px;
        }
        .panel {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .button {
            margin: 5px 0;
            padding: 10px;
            background-color: green;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .button:disabled {
            background-color: grey;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="panel">
        <select id="bikeSelector">
            <option value="Bike 1">Bike 1</option>
            <option value="Bike 2">Bike 2</option>
            <option value="Bike 3">Bike 3</option>
        </select>
        <button id="findDestinationButton" class="button">Find Destination</button>
        <button id="trackingBikeButton" class="button">Tracking Bike</button>
        <p id="distanceLabel">Total Distance: N/A</p>
    </div>

    <script>
        // Initialize the map
        const map = L.map('map').setView([21.022736, 105.852194], 13);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Bike images
        const bikeImages = {
            "Bike 1": "https://i.postimg.cc/6qxZPGW0/bike-1-removebg-preview.png",
            "Bike 2": "https://i.postimg.cc/0jGS12rq/bike-2-removebg-preview.png",
            "Bike 3": "https://i.postimg.cc/QNc1TSmn/bike-3-removebg-preview.png"
        };

        let currentLocation = [21.022736, 105.852194]; // Default location
        let selectedBike = null;
        let routingControl = null;

        // Add marker for current location
        const currentLocationMarker = L.marker(currentLocation, {
            icon: L.icon({
                iconUrl: "https://i.postimg.cc/ZnWC4bDD/location-removebg-preview.png",
                iconSize: [40, 40]
            })
        }).addTo(map);

        // Function to generate random destination points within a radius
        function generateRandomPoints(center, count, radius) {
            const points = [];
            for (let i = 0; i < count; i++) {
                const angle = Math.random() * 2 * Math.PI;
                const distance = Math.random() * radius;
                const offsetX = distance * Math.cos(angle);
                const offsetY = distance * Math.sin(angle);
                points.push([
                    center[0] + offsetY / 111320,
                    center[1] + offsetX / (111320 * Math.cos(center[0] * Math.PI / 180))
                ]);
            }
            return points;
        }

        // Handle bike selection
        const bikeSelector = document.getElementById('bikeSelector');
        bikeSelector.addEventListener('change', function () {
            selectedBike = bikeSelector.value;

            // Add bike marker at the current location
            if (selectedBike) {
                const bikeIcon = L.icon({
                    iconUrl: bikeImages[selectedBike],
                    iconSize: [40, 40]
                });
                L.marker(currentLocation, { icon: bikeIcon }).addTo(map);
            }
        });

        // Handle "Find Destination" button
        const findDestinationButton = document.getElementById('findDestinationButton');
        const distanceLabel = document.getElementById('distanceLabel');

        findDestinationButton.addEventListener('click', function () {
            if (routingControl) map.removeControl(routingControl);

            const destinationPoint = generateRandomPoints(currentLocation, 1, 3000)[0];
            routingControl = L.Routing.control({
                waypoints: [L.latLng(currentLocation), L.latLng(destinationPoint)],
                routeWhileDragging: false,
                createMarker: () => null, // No markers
                show: false // Disable route instructions
            }).addTo(map);

            routingControl.on('routesfound', function (e) {
                const route = e.routes[0];
                const totalDistance = (route.summary.totalDistance / 1000).toFixed(2); // Convert to km
                distanceLabel.textContent = `Total Distance: ${totalDistance} km`;
            });
        });

        // Handle "Tracking Bike" button
        const trackingBikeButton = document.getElementById('trackingBikeButton');
        trackingBikeButton.addEventListener('click', function () {
            if (!selectedBike) {
                alert('Please select a bike first!');
                return;
            }

            const randomPoints = generateRandomPoints(currentLocation, 5, 3000);
            let index = 0;

            const bikeIcon = L.icon({
                iconUrl: bikeImages[selectedBike],
                iconSize: [40, 40]
            });

            const bikeMarker = L.marker(randomPoints[0], { icon: bikeIcon }).addTo(map);

            const interval = setInterval(() => {
                if (index < randomPoints.length) {
                    bikeMarker.setLatLng(randomPoints[index]);
                    index++;
                } else {
                    clearInterval(interval);
                }
            }, 1000); // Move every second
        });
    </script>
</body>
</html>
